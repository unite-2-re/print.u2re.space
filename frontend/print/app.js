import{r as e,h as t}from"./modules/solid-js.js";import{m as n}from"./modules/marked.js";import{observeContentBox as o,observeBySelector as r}from"/externals/lib/dom.js";const i={apply(e,t,n){e.target=n?.[0]??e.target},set:(e,t,n)=>e.target?Reflect.set(e.target,t,n):1,get:(e,t,n)=>"@target"==t?e.target:e.target?Reflect.get(e.target,t):null,has:(e,t)=>e.target?Reflect.has(e.target,t):0,ownKeys:e=>e.target?Reflect.ownKeys(e.target):[]};let a=null;const s=async(e="",t=0)=>{const n=e?.url??e,o=(e=>{if("string"!=typeof e)return e;e=e?.trim?.()||e,e?.endsWith?.("/")||(e=e?.trim?.()?.split?.("/")?.slice(0,-1)?.join?.("/")?.trim?.()||e);const t=e?.trim()?.endsWith("/")?e:e+"/";return t?.startsWith("/")?t:"/"+t})(n?.replace?.(location.origin,"")?.trim?.()),r=n?.split("/")?.at?.(-1);if(!URL.canParse(n)&&o?.trim()?.startsWith?.("/user")){const e=await(a??=(async()=>{const e=await import("/externals/vendor/happy-opfs.mjs").catch(console.warn.bind(console)),t="undefined"!=typeof Deno?Deno:null;let n=null;if(!e?.isOPFSSupported?.())try{n=await import("node:fs/promises").catch(console.warn.bind(console))}catch(e){console.warn(e)}return e?.isOPFSSupported?.()?e:t??n??e})()),n=o?.replace?.("/user/","")?.trim?.(),i=((n?.split?.("/")||[n])?.filter?.((e=>!!e?.trim?.()))||[""])?.join?.("/")||"",s=(i&&"/"!=i?"/"+i+"/":i)||"/";if("/"!=s&&await(e?.mkdir?.(s)),t)return{write:t=>e?.writeFile?.(s+r,t)};const c=await(e?.readFile?.(s+r,{encoding:"blob"}));let l=null;try{l=c?.unwrap?.()??c}catch(e){}return l}return fetch(e).then((async e=>{const t=await e.blob(),o=Date.parse(e.headers.get("Last-Modified")||"")||0;return new File([t],n.substring(n.lastIndexOf("/")+1),{type:t.type,lastModified:o})}))},c=()=>{const e=((e=null)=>{const t=()=>{};return t.target=e,new Proxy(t,i)})(null),r=async e=>{a(e),(e instanceof File||e instanceof Blob)&&(await s("/user/temp/view.md",1))?.write?.(e)};document.addEventListener("ext-set-md",(e=>{r(e?.detail?.doc)}));const a=t=>{"string"==typeof t?e.innerHTML=n(t)||e.innerHTML:(t instanceof File||t instanceof Blob||t instanceof Response)&&t?.text()?.then?.((t=>e.innerHTML=n(t)||e.innerHTML))};return t`<div id="app" data-theme="light" data-scheme="solid" data-chroma="0.05" data-chroma="1" data-alpha="1" data-highlight="2" style="pointer-events: auto;" data-print-pass>
        <nav>
            <div class="row">
                <button data-highlight="2" data-highlight-hover="3" class="open-file" on:click=${()=>(async()=>{const e="showOpenFilePicker",t=window?.[e]?.bind?.(window)??(await import("/externals/polyfill/showOpenFilePicker.mjs"))?.[e];return t({types:[{description:"wallpaper",accept:{"text/*":[".md"]}}],multiple:0})?.then?.((async([e]=[])=>{const t=await(e?.getFile?.());r(t)}))})()}><ui-icon icon="notebook-text"></ui-icon></button>
            </div>
            <div class="row">
                
            </div>
        </nav>
        <main ref=${e=>{o(e,(t=>{e.style.setProperty("--fit-width",Math.min(t.inlineSize-64,1200)||800)}))}} data-print-pass data-scheme="solid" data-theme="light" on:drop=${e=>{e?.preventDefault?.();const t=e?.dataTransfer?.files?.[0];t&&r(t)}} on:dragover=${e=>{e?.preventDefault?.()}}>
            <div ref=${()=>{requestIdleCallback((async()=>{const e=await s("/user/temp/view.md");e&&a(e)}))}} ref=${e} data-print id="markdown" ></div>
        </main>
    </div>`},l="@layer adl-md-view{@media screen{#app{display:flex;padding:.5rem;place-content:center;place-items:center;place-self:center}#app,#viewport{block-size:100%;flex-direction:column;flex-wrap:nowrap;inline-size:100%;min-block-size:100%}#viewport{display:flex;padding:0;place-content:center;place-items:center;place-self:center}nav{background-color:initial;block-size:4rem;display:flex;flex-direction:column;inline-size:100%;min-block-size:4rem;place-content:stretch;place-items:stretch;place-self:stretch;text-align:start}nav button{block-size:100%;border-radius:.5rem;inline-size:max-content;padding:.5rem}nav .row{background-color:initial;flex-basis:50%;flex-direction:row;text-align:start}main,nav .row{display:flex;inline-size:100%;place-content:center;justify-content:start;place-items:center}main{align-self:center;flex-basis:stretch;flex-direction:column;flex-grow:1;flex-wrap:wrap;overflow:auto;place-self:center;scrollbar-color:var(--rv-color,currentColor) var(--rv-bg-color,currentColor);user-select:auto}#markdown,main{border-radius:.5rem;font-size:16px;pointer-events:auto}#markdown{block-size:100%;container-type:inline-size;display:block;inline-size:calc(var(--page-width, 210) * 1mm);justify-content:start;justify-items:start;line-height:normal;min-block-size:max-content;overflow:hidden;padding-block:16mm;padding-inline:16mm;scale:calc(var(--fit-width, 800) / (var(--page-width, 210) * 3.7795275591));text-align:justify;transform-origin:50% 0;user-select:text}#markdown :where(*){pointer-events:auto;user-select:text}#markdown a{user-select:none}#markdown .center{justify-self:center}}@media print{body{block-size:100dvb;min-block-size:100dvb}#viewport{block-size:100%;min-block-size:max-content}#viewport,#viewport #markdown{container-type:inline-size;inline-size:100%}#viewport #markdown{block-size:max-content;min-block-size:100%;text-align:justify}}}",m=async e=>{const t=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return"sha256-"+btoa(String.fromCharCode.apply(null,new Uint8Array(t)))},d=async(e,t,n)=>{const o=URL.canParse(e)?e:URL.createObjectURL(new Blob([e],{type:"text/css"}));if(t?.[0]&&(!URL.canParse(e)||n)&&t?.[0]instanceof HTMLLinkElement){const o=n??m(e);"function"==typeof o?.then?o?.then?.((e=>t?.[0]?.setAttribute?.("integrity",e))):t?.[0]?.setAttribute?.("integrity",o)}t&&((e,t)=>{e[0][e[1]]="innerHTML"==e[1]?`@import url("${t}");`:t})(t,o)},p=URL.createObjectURL(new Blob([l],{type:"text/css"})),u=m(l),f=(e=document.head)=>{((e,t=document.head,n=u)=>{const o=t?.querySelector?.("head")??t;if(o instanceof HTMLHeadElement)return(e=>{const t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.crossOrigin="same-origin",t.dataset.owner="adl",d(e,[t,"href"],void 0),document.head.appendChild(t),t})(e);const r=document.createElement("style");r.dataset.owner="adl",d(e,[r,"innerHTML"],n),o?.appendChild?.(r)})(p,e)},w=async n=>{const o=new FontFace("Open Sans",'url("/assets/fonts/OpenSans-VariableFont_wdth,wght.ttf")',{}),r=new FontFace("Open Sans Italic",'url("/assets/fonts/OpenSans-Italic-VariableFont_wdth,wght.ttf")',{}),i=new FontFace("Source Sans 3",'url("/assets/fonts/SourceSans3-VariableFont_wght.ttf")',{}),a=new FontFace("Source Sans 3 Italic",'url("/assets/fonts/SourceSans3-Italic-VariableFont_wght.ttf")',{});document.fonts?.add?.(o),document.fonts?.add?.(r),document.fonts?.add?.(i),document.fonts?.add?.(a);const s=Promise.allSettled([import("/externals/core/agate.js"),import("/externals/core/core.js"),import("/externals/core/theme.js"),import("/externals/core/grid.js"),import("/externals/core/design.js"),import("/externals/core/existence.js"),import("/externals/wcomp/ui.js"),import("/externals/wcomp/longtext.js"),import("/externals/wcomp/rows.js"),import("/externals/wcomp/scrollbox.js"),import("/externals/wcomp/image.js")]);await Promise.allSettled([f?.(n),s?.then?.((e=>Promise.allSettled(e.map((e=>Promise.try(e?.value?.default))))))?.catch?.(console.warn.bind(console))]),(n=>{e((()=>t`<${c}><//>`),n)})(n)},h=e=>{const t=e?.target;t?.matches?.("img:not(.error)")&&t?.classList?.add("error")},g=e=>{const t=e?.target;t?.matches?.("img.error")&&t?.classList?.remove("error")};document.documentElement.addEventListener("error",h),r(document.documentElement,"img:not(.error)",(e=>{e?.addedNodes?.forEach?.((e=>{e.complete||e?.classList?.add("error"),e?.addEventListener?.("error",h),e?.addEventListener?.("load",g)}))})),r(document.documentElement,"img.error, img",(e=>{e?.addedNodes?.forEach?.((e=>{e.complete&&e?.classList?.remove("error"),e?.addEventListener?.("error",h),e?.addEventListener?.("load",g)}))}));export{w as default,w as initialize};